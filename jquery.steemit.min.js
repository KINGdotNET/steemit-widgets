/**
 * jQuery Steemit Plugin
 * @author mkt <kontakt@markus-kottlaender.de>
 * @license MIT
 */
!function(e){e.fn.steemit=function(){var t=this,a={};return a.profile=function(i){var r=e.extend({user:"mkt",template:'<img width="100" src="${IMAGE}" /><br><a href="https://steemit.com/@${USER}">@${USER}</a>',reputationPrecision:0,votingPowerPrecision:2},i);steem.api.getAccounts([r.user],function(e,i){if(!e&&i.length){var i=i[0],l=JSON.parse(i.json_metadata).profile;steem.api.getFollowCount(r.user,function(e,o){var c=a.getTemplate(r.template).replace(/\${USER}/gi,i.name).replace(/\${NAME}/gi,l.name).replace(/\${LOCATION}/gi,l.location).replace(/\${WEBSITE}/gi,l.website).replace(/\${IMAGE}/gi,l.profile_image).replace(/\${REPUTATION}/gi,a.calculateReputation(i.reputation,r.reputationPrecision)).replace(/\${VOTINGPOWER}/gi,a.calculateVotingPower(i.voting_power,i.last_vote_time,r.votingPowerPrecision)).replace(/\${FOLLOWERS}/gi,o.follower_count).replace(/\${FOLLOWING}/gi,o.following_count).replace(/\${POSTCOUNT}/gi,i.post_count).replace(/\${ABOUT}/gi,l.about);t.html(c)})}})},a.blog=function(i){var r=e.extend({user:"mkt",limit:10,template:'<div><a href="${URL}">${TITLE}</a>${RESTEEMED}<br>${Payout}, ${UPVOTES} Upvotes, ${COMMENTS} Comments</div>',defaultImage:"https://steemitimages.com/DQmXYX9hqSNcikTK8ARb61BPnTk4CKMhaiqr22iCKD8CKsp/steemit-logo.png",resteemedIndicator:" (resteemed) ",payoutPrecision:2,dateCallback:function(e){return e}},i);steem.api.getDiscussionsByBlog({tag:r.user,limit:r.limit},function(e,i){for(var l="",o=0;o<i.length;o++){var c=JSON.parse(i[o].json_metadata),n=a.getTemplate(r.template).replace(/\${URL}/gi,"https://steemit.com"+i[o].url).replace(/\${TITLE}/gi,i[o].title).replace(/\${AUTHOR}/gi,i[o].author).replace(/\${RESTEEMED}/gi,i[o].author!=r.user?r.resteemedIndicator:"").replace(/\${RESTEEMEDBY}/gi,i[o].first_reblogged_by?"resteemed by "+i[o].first_reblogged_by:"").replace(/\${DATE}/gi,r.dateCallback(new Date(i[o].created))).replace(/\${IMAGE}/gi,c.image?c.image[0]:r.defaultImage).replace(/\${PAYOUT}/gi,a.getPayout(i[o]).toFixed(r.payoutPrecision)).replace(/\${COMMENTS}/gi,i[o].children).replace(/\${UPVOTES}/gi,i[o].net_votes).replace(/\${CATEGORY}/gi,i[o].category);l+=n}t.html(l)})},a.feed=function(i){var r=e.extend({user:"mkt",limit:10,template:'<div><a href="${URL}">${TITLE}</a>${RESTEEMED}<br>${Payout}, ${UPVOTES} Upvotes, ${COMMENTS} Comments</div>',defaultImage:"https://steemitimages.com/DQmXYX9hqSNcikTK8ARb61BPnTk4CKMhaiqr22iCKD8CKsp/steemit-logo.png",resteemedIndicator:" (resteemed) ",payoutPrecision:2,dateCallback:function(e){return e}},i);steem.api.getDiscussionsByFeed({tag:r.user,limit:r.limit},function(e,i){for(var l="",o=0;o<i.length;o++){var c=JSON.parse(i[o].json_metadata),n=a.getTemplate(r.template).replace(/\${URL}/gi,"https://steemit.com"+i[o].url).replace(/\${TITLE}/gi,i[o].title).replace(/\${AUTHOR}/gi,i[o].author).replace(/\${RESTEEMED}/gi,i[o].first_reblogged_by?r.resteemedIndicator:"").replace(/\${RESTEEMEDBY}/gi,i[o].first_reblogged_by?"resteemed by "+i[o].first_reblogged_by:"").replace(/\${DATE}/gi,r.dateCallback(new Date(i[o].created))).replace(/\${IMAGE}/gi,c.image?c.image[0]:r.defaultImage).replace(/\${PAYOUT}/gi,a.getPayout(i[o]).toFixed(r.payoutPrecision)).replace(/\${COMMENTS}/gi,i[o].children).replace(/\${UPVOTES}/gi,i[o].net_votes).replace(/\${CATEGORY}/gi,i[o].category);l+=n}t.html(l)})},a.new=function(i){var r=e.extend({tag:null,limit:10,template:'<div><a href="${URL}">${TITLE}</a><br>${Payout}, ${UPVOTES} Upvotes, ${COMMENTS} Comments</div>',defaultImage:"https://steemitimages.com/DQmXYX9hqSNcikTK8ARb61BPnTk4CKMhaiqr22iCKD8CKsp/steemit-logo.png",payoutPrecision:2,dateCallback:function(e){return e}},i);steem.api.getDiscussionsByCreated({tag:r.tag,limit:r.limit},function(e,i){for(var l="",o=0;o<i.length;o++){var c=JSON.parse(i[o].json_metadata),n=a.getTemplate(r.template).replace(/\${URL}/gi,"https://steemit.com"+i[o].url).replace(/\${TITLE}/gi,i[o].title).replace(/\${AUTHOR}/gi,i[o].author).replace(/\${DATE}/gi,r.dateCallback(new Date(i[o].created))).replace(/\${IMAGE}/gi,c.image?c.image[0]:r.defaultImage).replace(/\${PAYOUT}/gi,a.getPayout(i[o]).toFixed(r.payoutPrecision)).replace(/\${COMMENTS}/gi,i[o].children).replace(/\${UPVOTES}/gi,i[o].net_votes).replace(/\${CATEGORY}/gi,i[o].category);l+=n}t.html(l)})},a.hot=function(i){var r=e.extend({tag:null,limit:10,template:'<div><a href="${URL}">${TITLE}</a><br>${Payout}, ${UPVOTES} Upvotes, ${COMMENTS} Comments</div>',defaultImage:"https://steemitimages.com/DQmXYX9hqSNcikTK8ARb61BPnTk4CKMhaiqr22iCKD8CKsp/steemit-logo.png",payoutPrecision:2,dateCallback:function(e){return e}},i);steem.api.getDiscussionsByHot({tag:r.tag,limit:r.limit},function(e,i){for(var l="",o=0;o<i.length;o++){var c=JSON.parse(i[o].json_metadata),n=a.getTemplate(r.template).replace(/\${URL}/gi,"https://steemit.com"+i[o].url).replace(/\${TITLE}/gi,i[o].title).replace(/\${AUTHOR}/gi,i[o].author).replace(/\${DATE}/gi,r.dateCallback(new Date(i[o].created))).replace(/\${IMAGE}/gi,c.image?c.image[0]:r.defaultImage).replace(/\${PAYOUT}/gi,a.getPayout(i[o]).toFixed(r.payoutPrecision)).replace(/\${COMMENTS}/gi,i[o].children).replace(/\${UPVOTES}/gi,i[o].net_votes).replace(/\${CATEGORY}/gi,i[o].category);l+=n}t.html(l)})},a.trending=function(i){var r=e.extend({tag:null,limit:10,template:'<div><a href="${URL}">${TITLE}</a><br>${Payout}, ${UPVOTES} Upvotes, ${COMMENTS} Comments</div>',defaultImage:"https://steemitimages.com/DQmXYX9hqSNcikTK8ARb61BPnTk4CKMhaiqr22iCKD8CKsp/steemit-logo.png",payoutPrecision:2,dateCallback:function(e){return e}},i);steem.api.getDiscussionsByTrending({tag:r.tag,limit:r.limit},function(e,i){for(var l="",o=0;o<i.length;o++){var c=JSON.parse(i[o].json_metadata),n=a.getTemplate(r.template).replace(/\${URL}/gi,"https://steemit.com"+i[o].url).replace(/\${TITLE}/gi,i[o].title).replace(/\${AUTHOR}/gi,i[o].author).replace(/\${DATE}/gi,r.dateCallback(new Date(i[o].created))).replace(/\${IMAGE}/gi,c.image?c.image[0]:r.defaultImage).replace(/\${PAYOUT}/gi,a.getPayout(i[o]).toFixed(r.payoutPrecision)).replace(/\${COMMENTS}/gi,i[o].children).replace(/\${UPVOTES}/gi,i[o].net_votes).replace(/\${CATEGORY}/gi,i[o].category);l+=n}t.html(l)})},a.getTemplate=function(e){var t=document.getElementById(e);return t?t.innerHTML:e},a.getPayout=function(e){if("1970-01-01T00:00:00"==e.last_payout){var t=e.pending_payout_value.replace(" SBD","");return parseFloat(t)}var a=e.total_payout_value.replace(" SBD",""),i=e.curator_payout_value.replace(" SBD","");return parseFloat(a)+parseFloat(i)},a.calculateReputation=function(e,t){return(9*(Math.log(e)/Math.LN10-9)+25).toFixed(t)},a.calculateVotingPower=function(e,t,a){var i=(new Date-new Date(t+"Z"))/1e3;return e+=1e4*i/432e3,Math.min(e/100,100).toFixed(a)},a}}(jQuery);
